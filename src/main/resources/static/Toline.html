<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Toline</title>
    <link rel="icon" href="img/logoarchive.png" />
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/navi.css">
        <link rel="stylesheet" href="css/triangle.css">
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
        <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <script type="text/javascript" src="http://beneposto.pl/jqueryrotate/js/jQueryRotateCompressed.js"></script>
        <style>
            /* Remove the navbar's default margin-bottom and rounded borders */
            .navbar {
                margin-bottom: 0;
                border-radius: 0;
            }

            /* Set height of the grid so .sidenav can be 100% (adjust as needed) */
            .row.content {height: 450px}

            footer {
                background-color: #555;
                color: white;
                padding: 15px;
            }

            /* On small screens, set height to 'auto' for sidenav and grid */
            @media screen and (max-width: 767px) {
                .sidenav {
                    height: auto;
                    padding: 15px;
                }
                .row.content {height:auto;}
            }
        </style>
        </head>
<body>
<!--메인헤더-->
<div ng-app="frindListApp">
<div ng-include="'mainHeader.html'"></div>
<!--서브헤더-->
<div ng-include="'subHeader.html'"></div>

<!--화면 분할 시작-->
<div class="container-fluid" style="margin-bottom: 50px;">
    <div class="row content">
        <!--좌측 화면분할-->
        <div class="col-sm-2 col-xs-2 sidenav hidden-xs" >
            <div class="container-fluid " >
                <p>좌측 화면 분할 </p>
            </div>
        </div>

        <!--가운데 콘텐츠 화면분할-->
        <div class="col-sm-8 col-xs-12">
            <div class="container-fluid">
                <div class="header">
                    <h3 class="text-muted prj-name text-center">
                        <span class="fa fa-users fa-2x principal-title"></span>
                        Friend zone
                    </h3>
                </div>


                <div class="jumbotron list-content">

                    <ul class="list-group " ng-controller="friendListCtrl">
                        <form class="navbar-form " role="search" style="text-align: right">
                            <div class="input-group">
                                <input type="text" ng-model="finduser" class="form-control" placeholder="Search" name="q">
                                <div class="input-group-btn">
                                    <button class="btn btn-default" type="reset"><span class="glyphicon glyphicon-refresh"></span></button>
                                </div>
                            </div>
                        </form>
                        <li href="#" class="list-group-item title">
                            연결고리
                        </li>
                        <li href="#" ng-repeat="x in friends | filter : finduser" class="list-group-item text-left">
                            <img class="img-thumbnail" src="img/someone.png">
                            <label class="name">
                                {{x.name}}<br>
                            </label>
                            <label class="pull-right">
                                <div ng-switch on="x.status">
                                    <div ng-switch-when="0">
                                        Friend request
                                        <a  class="btn btn-success btn-xs glyphicon glyphicon-ok" ng-click="acceptFriend(x.user_id)" title="Ok"></a>
                                        <a  class="btn btn-danger  btn-xs glyphicon glyphicon-trash" ng-click="deleteFriend(x.user_id)" title="Delete"></a>
                                        <a  class="btn btn-info  btn-xs glyphicon glyphicon glyphicon-comment" ng-click="#" title="Send message"></a>
                                    </div>
                                    <div ng-switch-when="1">
                                        <a  class="btn btn-danger  btn-xs glyphicon glyphicon-trash" ng-click="deleteFriend(x.user_id)" title="Delete"></a>
                                        <a  class="btn btn-info  btn-xs glyphicon glyphicon glyphicon-comment" ng-click="#" title="Send message"></a>
                                    </div>
                                    <div ng-switch-when="2">
                                        <p class="text-center">Me</p>
                                    </div>
                                </div>

                            </label>
                            <div class="break"></div>
                        </li>

                        <!--
                        <li href="#" class="list-group-item text-left">
                            <a class="btn btn-block btn-primary">
                                <i class="glyphicon glyphicon-refresh"></i>
                                Load more...
                            </a>
                        </li>
                        -->
                    </ul>
                </div>
            </div>
        </div>


        <!--우측 화면 분할-->
        <div class="col-sm-2 hidden-xs sidenav">
            <div class="well">
                <p>ADS</p>
            </div>
            <div class="well">
                <p>ADS</p>
            </div>
        </div>
    </div>
</div>




<!--푸터-->
<div ng-include="'mainFooter.html'"></div>

</div>
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>

<script>
    var app0 = angular.module("frindListApp",[]);
    app0.controller("friendListCtrl",function($scope, $http){

        //TODO: 로그인 정보를 토큰에서 받는것으로 변경하기

        var loginObject = {
            user_id : 1
        };

        $http({
            method: 'POST', //방식
            url: "/user/showfriends", /* 통신할 URL */
            data: loginObject, /* 파라메터로 보낼 데이터 */
            headers: {'Content-Type': 'application/json; charset=utf-8'} //헤더
        })
                .then(function(response) {
                    $scope.friends = response.data;
                });

        $scope.acceptFriend = function (friend_id){
            var acceptFriendObject =
            {
                user_id: friend_id, //임시로 1번사용자 지정
                friend_id: 1
            };
            $http({
                method: 'POST', //방식
                url: "/user/acceptFriend", /* 통신할 URL */
                data: acceptFriendObject, /* 파라메터로 보낼 데이터 */
                headers: {'enctype': 'multipart/form-data; charset=utf-8'} //헤더
            })
                    .success(function (data, status, headers, config) {
                        if(data.msg == 'false') {
                            alert('친구승낙 실패')
                        }else{
                            alert('친구승낙 성공');
                            window.location.href = 'Toline.html';
                        }
                    })
                    .error(function (data, status, headers, config) {
                        /* 서버와의 연결이 정상적이지 않을 때 처리 */
                        console.log(status);
                    });
        };

        $scope.deleteFriend = function (friend_id){
            var deleteFriendObject =
            {
                user_id: 1, //임시로 1번사용자 지정
                friend_id: friend_id
            };
            $http({
                method: 'POST', //방식
                url: "/user/deleteFriend", /* 통신할 URL */
                data: deleteFriendObject, /* 파라메터로 보낼 데이터 */
                headers: {'enctype': 'multipart/form-data; charset=utf-8'} //헤더
            })
                    .success(function (data, status, headers, config) {
                        if(data.msg == 'false') {
                            alert('친구삭제 실패')
                        }else{
                            alert('친구삭제 성공');
                            window.location.href = 'Toline.html';
                        }
                    })
                    .error(function (data, status, headers, config) {
                        /* 서버와의 연결이 정상적이지 않을 때 처리 */
                        console.log(status);
                    });
        };
    });




</script>
<script src="js/bootstrap.js"></script>

</body>
</html>
